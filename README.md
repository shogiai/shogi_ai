# 将棋アプリDocs### 他の将棋アプリと比較して(他の将棋アプリには無い)良いと思われるところ- (対局開始時) 通常配置を含む7種類の初期局面を用意していて、色々な局面から変化を付けて遊ぶことができます- (対局中) 盤面の駒の移動範囲や手番、二歩、王手など、優しいガイド機能を搭載しています- (対局後) 棋譜出力機能があり、対局終了後の棋譜がkifu.textに保存され、過去に指した棋譜をいつでもまとめて見ることができます------------## 遊び方### 1. 実行まで- takashi-shogiappフォルダ直下のscala_shogiフォルダで、sbt comoile/sbt runをすることで実行が可能です### 2. アプリの状態構成と遷移- 初期画面
	- "sbt comoile/sbt run"をすると、"初期画面"へ遷移します
	- 一手指すと対局画面へ遷移します- 対局画面
	- 対局が開始する(一手指される)と、対局画面へ遷移します
	- その局面の勝敗が決定した場合には、初期画面へ遷移します### 3. 初期画面- "A~G"のボタンをクリックすると、"押したボタンに応じた7種類の初期配置"で、新たな局面でゲームを始めることができます	- "押したボタンに応じた初期配置"のルールについては、以下をご確認下さい```"A": 通常の将棋のルール通りの駒配置で、局面がスタートします"B": 歩の下の先手は8,9段目、後手は1,2段目に歩以外の駒がランダムに配置されます"C": 6段目の歩の下の先手は7,8,9段目、後手も同様です"D": 先手は6~9段目、後手は1~4段目に駒がランダムに配置されます"E": 斜めに並んだ歩の下に駒が配置されます"F": 斜めの位置にランダムに駒が配置されます"G": 9×9マス中にランダムに駒が配置されます```- 先手の駒をクリックして動かす先を再度クリックすると、"対局状態"へ遷移します
   ### 4. 対局状態#### 4-1. 駒を動かす```
(手順)1. 駒をクリックして選択します(駒が選択された場合、駒の位置が青くなります)2. 後に、動かす先をクリックすることで、局面を進めることができます(動いた駒の選択が外れ、手番が相手側に移行します)
```- 駒を動かす(盤面から盤面への移動)	- 駒の動きのルールを満たす場合に移動させることが可能です
		- 駒の動きのルールは[こちら](https://www.jti.co.jp/knowledge/shogi-kids/beginners_guide/howtomove/index.html "タイトル")をご参照下さい- 駒の持ち駒上から盤面への移動    - 持ち駒をクリックして駒の存在しない盤面上に移動させることが可能です    #### 4-2. 補助機能- 成り/不成の選択
	- 成り不成選択の条件を満たした場合に表示されます
	- 成りをクリックした場合対象の駒が成り、不成をクリックした場合駒は成らずにゲームを続行します- 待った	- "待"と書いた駒をクリックすると、1手だけ前へ巻き戻すことができます	- 投了- 投了
	- 二重確認形式になっています
	- 投了した側の負け(相手側の勝ち)となり、初期画面へと遷移します#### 4-2. 補助表示機能
- 先手番、後手番
	- 今どちら側の手番か表示されます- 二歩です
	- 二歩を打った場合に表示されます
- 先手詰み、後手詰み 
	- 王や玉が詰まされた場合に表示されます### 5. 棋譜出力- 対局終了後、指された棋譜が"scala_shogi"直下の"kifu.txt"に指した棋譜とその時の評価値が出力されます    ------------(以下ゲーム内部を詳しく知りたい方向け)## 機能ベース#### 局面の初期化- A~Gと書かれた駒をクリックすると、7種類の初期局面から対局がまたスタートとなります	- "A" 通常の将棋のルール通りの駒配置で、局面がスタートします	- "B" 歩の下の先手は8,9段目、後手は1,2段目に歩以外の駒がランダムに配置されます	- "C" 6段目の歩の下の先手は7,8,9段目、後手も同様です	- "D" 先手は6~9段目、後手は1~4段目に駒がランダムに配置されます	- "E" 斜めに並んだ歩の下に駒が配置されます	- "F" 斜めの位置にランダムに駒が配置されます	- "G" 9×9マス中にランダムに駒が配置されます### 駒を動かすとき- 選択したい駒をクリックして下さい	- 自分の手番では、相手の駒を動かすことはできません	- 相手の駒をクリックした後に、自分の駒をクリックするときはダブルクリックが必要- 駒の移動条件を満たす場合、そこに駒が移動して相手の手番になる	- (移動条件を満たさない場合は、駒の選択自体がキャンセルされる)### 表示機能について- "先手番""後手番"、"二歩です"、"王手です"、"先手の勝ち""後手の勝ち"、"成り/不成"があります- 始めはA~Gボタン、対局中は投了、待ったボタンがあります- 後手の駒でも、先手向きの文字で表示が出るようにしました### 成りの条件- 必ず成らなければならない場合	- 強制的に駒が成ります- 成る成らないを選択できる場合	- 手番側の駒で、成り/不成と出るので、		- 成る場合は、"成り"のどちらかをクリック		- 成らない場合は、"不成"のどちらかをクリックして下さい	- 選択されたら、その駒の成り不成が確定し、相手の手番になります### 勝敗の決定- 指した手で相手の王が詰んだならば詰ました方の勝ち(自分の王が取られる場合を除く)、手番側が相手の王を取れる場合も手番側の勝ちとなります- "先手の勝ち""後手の勝ち"という表示が出て、その後駒の選択が出来なくなります- 勝負がついた理由については、"先手詰み""後手詰み""勝ちあり"と表示が出ます### 持ち駒について- 持ち駒のスペースには駒ごとに重ねて置かれます	 	 ##### 待った- "待"と書いた駒をクリックすると、1手だけ前へ巻き戻すことができます##### 投了- 2段階式のボタンになっています- "投"と書いたボタンをクリックすると、"了"と書かれたボタンが出ます- "了"と書いたボタンをクリックすると投了となり、A~Gのボタンで新たに局面を始めることができます##### (暫定)局面評価関数- 駒の損得と駒の王への距離から判定しています、精度はこれからの課題です##### 棋譜出力- 対局終了後、棋譜が"scala_shogi"直下の"kifu.txt"に指した棋譜とその時の評価値(暫定)が出力されます------------## 設計### ShogiBoard.scala- 基本的な実行を担う### Board.scala- 盤面を定義しているクラス- ShogiBoardオブジェクトのcellObjGroup関数の中で使われる関数を多く含む- 評価関数もこちらで実装### Koma.scala- 駒の定義されているクラス、基本的にはBoard.scalaにて使われる### 描画- ScalaFXを使っています
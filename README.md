# 将棋アプリDocs### はじめに- shogiappフォルダ直下のscala_shogiフォルダで、"sbt comoile/sbt run"をすることで実行が可能です### 他の将棋アプリと比較して(他の将棋アプリには無い)良いと思われるところ- (対局開始時) 通常配置を含む7種類の初期局面を用意していて、色々な局面から変化を付けて遊ぶことができます- (対局中) 盤面の駒の移動範囲や手番、二歩、王手など、優しいガイド機能を搭載しています- (対局後) 棋譜出力機能があり、対局終了後の棋譜がkifu.textに保存され、過去に指した棋譜をいつでもまとめて見ることができます------------# 遊び方について## 1. 画面遷移(ゲームの流れ)### 0). 画面遷移図ゲーム開始画面 => プレイ中画面 => ゲーム終了画面 =>  ゲーム開始画面 => …   と(一般的なゲームと同様の)流れで遊ぶことができます。### 1). ゲーム開始画面- 一手指すとプレイ中画面に遷移します- 通常配置と独自配置をクリックして、何度でも好きなゲーム開始画面を始めることができます### 2). プレイ中画面- 勝敗が着くまで手を指し続けることが可能です- 勝負が着いたら、終了画面へと遷移します### 3). ゲーム終了画面- 通常配置ボタン、独自配置ボタンのどちらかを押すと初期画面へ遷移します- 対局終了時、指した棋譜と一手一手の評価値を出力することもできます	- 今まで指した棋譜とその時々の評価値を一覧形式で見ることができます	- 棋譜の読み方を知りたい方は[こちら](http://www.shogi.or.jp/faq/kihuhyouki.html "タイトル")をご参照下さい------------   ## 2. ユーザーインタフェース(具体的な遊び方)### 1). 駒を動かす- 駒の動きのルールを知りたい方は[こちら](https://www.jti.co.jp/knowledge/shogi-kids/beginners_guide/howtomove/index.html "タイトル")をご参照下さい- 盤上の自分の駒を選択すると、選択した駒と動ける範囲が描画され、その後のクリック箇所に応じて、挙動が決定します。	- 動ける範囲をクリック    	- 駒が移動して手番が相手に渡ります	- 別の自分の駒をクリック		- 駒の選択がクリックした駒に移ります	- その他の動けない場所をクリック		- 駒の選択が外れます	- 自分自身をクリック		- 何も起こりません- 基本的にはこの繰り返しで、勝敗が決定します。    ### 2). 補助機能- 以下の3種類で構成されています。	- 3.選択ボタン (青いボタン)	- 4.ルールに基づく状態表示 (緑色の駒)	- 5.局面評価に基づく状態表示 (赤色の駒)### 3). 選択ボタン (青色のボタン)- (主に)プレイ中での機能	- 待った(1手につき1回だけ許容)	- 投了 (確認ダイアログによる二重確認)	- 駒の成り/不成の選択- ゲーム終了画面 での機能   -    棋譜出力  <= プレイした棋譜と一手一手の局面評価値を出力できます- ゲーム終了画面からゲーム開始画面へ遷移する機能	- 通常配置	- 独自配置		- 6種類のルールに従って乱数を振った局面からのスタートできます```ルール１ 歩以外の駒が歩の下の駒にランダムに配置されますルール２ 歩の位置が1つ上がり、歩の下の3段に駒がランダムに配置されますルール３ 先手は6~9段目、後手は1~4段目に駒がランダムに配置されますルール４ 斜めに並んだ歩の下に駒が配置されますルール５ 斜めの位置にランダムに駒が配置されますルール６ 9×9マス中にランダムに駒が配置されます```### 4). ルールに基づく状態表示 (緑色の駒)- (主に)プレイ中画面で表示される機能	- 先手番 / 後手番	- 二歩です	- 王手です- プレイ中画面 => ゲーム終了画面 へ遷移した時に表示される機能	- 先手投了 / 後手投了	- 先手詰み / 後手詰み		- 内部的に詰み判定機能で判定、詰んでいれば表示が出ます			- 逃げる、取り返す、中合いの3パターンの王手回避方法ができるかを内部的に判定### 5). 局面評価に基づく状態表示 (赤色の駒)- プレイ中画面で表示される機能	- 互角	- 先手有利 / 後手有利	- 先手優勢 / 後手優勢		- 評価関数(プロトタイプ)を元に局面の有利不利を判定			- 「駒の損得」と「駒の互いの王までの距離」から評価値を算出			- (王と、自分の駒が近くにいればプラス評価、相手の駒が近くにいればマイナス評価として判定 )- プレイ中画面 => ゲーム終了画面 へ遷移した時に表示される機能	- 先手勝ち / 後手勝ち### 6). カーソルガイド機能- クリックできる(選択の状態変化がある)カーソルに合わせるとカーソルが変わるガイド機能が入っているので、参考にしてください    - 1.選択できる駒、駒を動かすことができるセルにカーソルが合う        - “開いた手のマーク”のカーソルになります    - 2.押せるボタンがあるセルにカーソルが合う        - “指を指す手のマーク”のカーソルになります    - 3.それ以外のクリックできないセルにカーソルが合う        - “矢印”のようなカーソルになります### 7). ダイアログ表示- "投了"ボタン    - "投了"ボタンを押した場合には、本当に投了をするか確認するダイアログが出ます- "独自配置"ボタンを押したとき    - どのルールを選択すると良いのか、を選択するためのダイアログが出ます- 勝敗が決定した時    - どちらの勝ちなのか、とその理由がお知らせ形式で出ます------------## 設計### ShogiBoard.scala- 基本的な実行を担う### Board.scala- 盤面を定義しているクラス- ShogiBoardオブジェクトのcellObjGroup関数の中で使われる関数を多く含む- 評価関数もこちらで実装### Koma.scala- 駒の定義されているクラス、基本的にはBoard.scalaにて使われる### 描画- ScalaFXを使っています